# üìö –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ CitySim

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ (C4 Level 2)
```mermaid
graph TD
    A[–ê–Ω–∞–ª–∏—Ç–∏–∫] --> B[–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å]
    B --> C[API Gateway]
    C --> D[Auth Service]
    C --> E[Project DB]
    C --> F[Calculation Core]
    F --> G[File Parser]
    G --> H[Raw Data Storage]
```
## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Frontend)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** React / Next.js

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–ª–æ–µ–≤
- –†–µ–¥–∞–∫—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å drag-and-drop
- –ü–∞–Ω–µ–ª—å —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### 2. API Gateway
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** FastAPI (Python)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- RESTful API —Å OpenAPI 3.0 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Auth0 / Keycloak

### 3. –Ø–¥—Ä–æ —Ä–∞—Å—á–µ—Ç–æ–≤
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** Python 3.10, Pandas, NetworkX

**–ú–µ—Ç—Ä–∏–∫–∏:**
- –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø—É—Ç–∏
- –ê–Ω–∞–ª–∏–∑ –∑–æ–Ω –ø–æ–∫—Ä—ã—Ç–∏—è
- –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–æ–≤

### 4. –•—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç         | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è     | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                              |
|------------------|----------------|------------------------------------------|
| –û—Å–Ω–æ–≤–Ω–∞—è –ë–î       | PostgreSQL 14  | –°—Ü–µ–Ω–∞—Ä–∏–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ       |
| –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ| MinIO          | –ò—Å—Ö–æ–¥–Ω—ã–µ GTFS / CSV —Ñ–∞–π–ª—ã                |
| –ö—ç—à               | Redis          | –°–µ—Å—Å–∏–∏, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã             |

---

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend
**–Ø–∑—ã–∫–∏:** Python 3.10+

**–§—Ä–µ–π–º–≤–æ—Ä–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- FastAPI –¥–ª—è API
- SQLAlchemy –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

**–°–£–ë–î:** PostgreSQL —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º PostGIS  
**–û—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á:** Celery + RabbitMQ

### Frontend
**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:**
- React 18 + TypeScript
- Deck.gl –¥–ª—è –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- Chart.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ú–µ—Ä—ã –∑–∞—â–∏—Ç—ã

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- JWT —Å 15-–º–∏–Ω—É—Ç–Ω—ã–º TTL
- Refresh —Ç–æ–∫–µ–Ω—ã —Å HTTP-only —Ñ–ª–∞–≥–æ–º

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
- RBAC —Å —Ä–æ–ª—è–º–∏: `–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä`, `–ê–Ω–∞–ª–∏—Ç–∏–∫`, `–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å`

**–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:**
- TLS 1.3 –¥–ª—è –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- AES-256 –¥–ª—è —Ñ–∞–π–ª–æ–≤—ã—Ö –≤–ª–æ–∂–µ–Ω–∏–π

---

## üì° API –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ö–ª—é—á–µ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å                  | –û–ø–∏—Å–∞–Ω–∏–µ                 |
|-------|-----------------------|--------------------------|
| POST  | `/auth/login`         | –ü–æ–ª—É—á–µ–Ω–∏–µ JWT            |
| POST  | `/scenarios`          | –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è |
| POST  | `/simulation`         | –ó–∞–ø—É—Å–∫ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è     |

**–ü—Ä–∏–º–µ—Ä —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

```yaml
paths:
  /simulation/{calculation_id}/results:
    get:
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      parameters:
        - name: calculation_id
          in: path
          required: true
```

### üöÄ –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞               | –ó–Ω–∞—á–µ–Ω–∏–µ                |
|-----------------------|-------------------------|
| –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API     | < 1 —Å–µ–∫ (p95)          |
| –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å–µ—Å—Å–∏–∏   | 1000+                  |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤      | 10 –ú–ë –∑–∞ ‚â§ 5 —Å–µ–∫       |

### üñ•Ô∏è –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç             | –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏          |
|-----------------------|-------------------------|
| –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π     | 4 vCPU, 8 GB RAM       |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–ë–î)      | 2 vCPU, 16 GB RAM, SSD |
| –°–µ—Ç—å                  | 1 Gbps, ‚â§ 50 ms latency|
