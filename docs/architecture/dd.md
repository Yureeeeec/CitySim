# üîç –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CitySim

```mermaid
flowchart TD
    subgraph –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π_—Å–ª–æ–π
        A[–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å SPA] -->|React 18 / TypeScript| B[–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã]
        A -->|Deck.gl| C[–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤]
        A -->|Chart.js| D[–ì—Ä–∞—Ñ–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç—ã]
        A -->|WebSocket| E[–†–µ–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö]
    end

    subgraph –°–µ—Ä–≤–µ—Ä–Ω—ã–π_—Å–ª–æ–π
        F[API Gateway] -->|FastAPI, REST| G[Auth Service (JWT)]
        F -->|gRPC| H[Scenario Service]
        F -->|AMQP| I[Calculation Service (Celery)]
        I --> J[–û—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á RabbitMQ]
    end

    subgraph Data_—Å–ª–æ–π
        K[(PostgreSQL + PostGIS)] --> H
        L[(Redis Cluster)] --> I
        M[(MinIO)] --> I
        N[Prometheus] -->|–ú–µ—Ç—Ä–∏–∫–∏| O[Grafana]
    end
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –°–ª–æ–π              | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç               | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏                         |
|-------------------|-------------------------|------------------------------------|
| –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–ª–æ–π   | SPA                     | React 18, TypeScript               |
|                   | –ö–∞—Ä—Ç–∞                   | Deck.gl, OpenLayers                |
|                   | –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç—ã        | Chart.js, D3.js                    |
|                   | Real-Time Updates       | WebSocket                          |
| –°–µ—Ä–≤–µ—Ä–Ω—ã–π —Å–ª–æ–π    | API Gateway             | FastAPI, OpenAPI 3.0               |
|                   | Auth Service            | JWT, OAuth2                        |
|                   | Scenario Service        | Python 3.10, SQLAlchemy, gRPC      |
|                   | Calculation Service     | Celery, Pandas                     |
|                   | –û—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á           | RabbitMQ                           |
| Data —Å–ª–æ–π         | –û—Å–Ω–æ–≤–Ω–∞—è –ë–î             | PostgreSQL + PostGIS               |
|                   | In-Memory Cache         | Redis Cluster                      |
|                   | –û–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ     | MinIO                              |
|                   | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥              | Prometheus, Grafana                |

## –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API**: ‚â§500 –º—Å (p99)  
- **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**: –¥–æ 1000 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π  
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: –¥–æ 10k RPM –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä–µ –∏–∑ 3 –Ω–æ–¥  
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: 99.9% SLA  

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã**: –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ  
- **Event-Driven**: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ RabbitMQ  
- **Security-by-Design**:
  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ JWT —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL (15 –º–∏–Ω)  
  - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö—Ä–∞–Ω–∏–ª–∏—â (AES-256)  
- **High Availability**:
  - –†–µ–ø–ª–∏–∫–∞—Ü–∏—è PostgreSQL  
  - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ MinIO
