# üîç –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CitySim

```mermaid
graph TD
    subgraph Frontend
        A[–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å] -->|React/TypeScript| B[–ö–∞—Ä—Ç–∞]
        A -->|Deck.gl| C[–ì—Ä–∞—Ñ–∏–∫–∏]
        A -->|Chart.js| D[–û—Ç—á–µ—Ç—ã]
    end

    subgraph Backend
        E[API Gateway] -->|FastAPI| F[–°–µ—Ä–≤–∏—Å —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤]
        E -->|JWT| G[–°–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏]
        E -->|Celery| H[–°–µ—Ä–≤–∏—Å —Ä–∞—Å—á–µ—Ç–æ–≤]
        E -->|Pandas| I[–°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏]
    end

    subgraph –•—Ä–∞–Ω–∏–ª–∏—â–∞
        J[(PostgreSQL)] -->|–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ| F
        K[(MinIO)] -->|–§–∞–π–ª—ã GTFS/CSV| H
        L[(Redis)] -->|–ö—ç—à| H
        M[RabbitMQ] -->|–û—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á| H
    end

    subgraph –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
        N[OpenStreetMap] -->|–ö–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ| B
        O[GTFS-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã] -->|–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö| F
    end

    A -->|HTTPS| E
    H -->|WebSocket| A
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç          | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏                          | –í–µ—Ä—Å–∏—è      |
|--------------------|-------------------------------------|-------------|
| **Frontend**       | React, TypeScript                   | 18.x, 5.0+  |
| **–ö–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—è**    | Deck.gl, OpenLayers                 | 8.8+, 7.3+  |
| **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**   | Chart.js, D3.js                     | 4.3+, 7.8+  |
| **API Gateway**    | FastAPI, OpenAPI 3.0                | 0.103+      |
| **–°–µ—Ä–≤–∏—Å—ã**        | Python, SQLAlchemy, Celery          | 3.10+, 2.0+ |

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
| –ü–∞—Ä–∞–º–µ—Ç—Ä                  | –ó–Ω–∞—á–µ–Ω–∏–µ                       |
|---------------------------|--------------------------------|
| –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞   | <500 –º—Å (p95)                  |
| –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å–µ—Å—Å–∏–∏       | –¥–æ 1000                        |
| –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö | –¥–æ 50 –ì–ë –Ω–∞ —Å—Ü–µ–Ω–∞—Ä–∏–π       |

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã**: –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- **–ß–µ—Ç–∫–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã**: 
  - OpenAPI-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è REST
  - Protobuf-—Å—Ö–µ–º—ã –¥–ª—è gRPC
- **–°–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ RabbitMQ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –¥–æ—Å—Ç–∞–≤–∫–∏

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: JWT —Å 15-–º–∏–Ω—É—Ç–Ω—ã–º TTL + refresh-—Ç–æ–∫–µ–Ω—ã
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**: 
  - TLS 1.3 –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
  - AES-256 –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- **–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å**: 
  ```mermaid
  flowchart LR
    A[–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä] --> B[–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø]
    C[–ê–Ω–∞–ª–∏—Ç–∏–∫] --> D[–°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
    E[–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å] --> F[–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ]
  ```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**:
  - –ó–∞–≥—Ä—É–∑–∫–∞ CPU/GPU
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
  - Latency API-–≤—ã–∑–æ–≤–æ–≤
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏**: ELK-—Å—Ç–µ–∫ (Elasticsearch, Logstash, Kibana)

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
```mermaid
flowchart LR
    A[–ö–ª–∏–µ–Ω—Ç] --> B[Load Balancer]
    B --> C[API Gateway 1]
    B --> D[API Gateway 2]
    C --> E[–°–µ—Ä–≤–∏—Å 1]
    D --> F[–°–µ—Ä–≤–∏—Å 2]
```

### –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
| –•—Ä–∞–Ω–∏–ª–∏—â–µ       | –°—Ç—Ä–∞—Ç–µ–≥–∏—è                      | RTO/RPO        |
|-----------------|--------------------------------|----------------|
| PostgreSQL      | Streaming Replication          | <30 —Å–µ–∫/<1 –º–∏–Ω |
| Redis           | Cluster Mode                   | <1 —Å–µ–∫         |
| MinIO           | Erasure Coding                 | 0/0            |

## Roadmap —Ä–∞–∑–≤–∏—Ç–∏—è
- Q3 2025: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ IoT
- Q4 2025: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (ML)
- Q1 2026: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç–∏
